name: Check for Hugo releases

on:
  schedule:
  - cron: '0 */3 * * *'   # run every three hours
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
    - name: Get latest Hugo version
      id: hugo_version
      run: |
        HUGO_VERSION=$(curl --silent https://api.github.com/repos/gohugoio/hugo/releases/latest | jq -r .tag_name | sed 's/v//')
        echo "::set-output name=VERSION::$HUGO_VERSION"
    - name: Get Dockerfile Hugo version
      id: local_version
      run: |
        LOCAL_VERSION=$(sed '3q;d' Dockerfile | cut -c18-23)
        echo "::set-output name=VERSION::$LOCAL_VERSION"
    - name: Compare versions
      id: update
      run: |
        echo "Local Hugo version is v${{ steps.local_version.outputs.VERSION }}."
        echo "Latest Hugo version is v${{ steps.hugo_version.outputs.VERSION }}."

        if [ "${{ steps.hugo_version.outputs.VERSION }}" != "${{ steps.local_version.outputs.VERSION }}" ]
        then
          echo "ðŸš¨ Needs updating!"
          exit 1
        else
          echo "âœ… All good for now."
          exit 0
        fi
